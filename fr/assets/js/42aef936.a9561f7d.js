"use strict";(self.webpackChunklancer_docs=self.webpackChunklancer_docs||[]).push([[5955],{833:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"documentation/security","title":"Secure webhook handling","description":"Info: This documentent primarily focuses on library authors. If you want to integrate Lancer into your application please checkout SDK & Packages page","source":"@site/docs/documentation/security.md","sourceDirName":"documentation","slug":"/documentation/security","permalink":"/lancer-docs/fr/docs/documentation/security","draft":false,"unlisted":false,"editUrl":"https://github.com/weekend-dev-labs/lancer-docs/docs/documentation/security.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Secure webhook handling"},"sidebar":"tutorialSidebar","previous":{"title":"Handling Webhook Events","permalink":"/lancer-docs/fr/docs/documentation/handling-webhook-events"},"next":{"title":"Libraries & SDK","permalink":"/lancer-docs/fr/docs/category/libraries--sdk"}}');var i=t(4848),r=t(8453);const o={sidebar_position:8,title:"Secure webhook handling"},a=void 0,c={},d=[{value:"Steps to Get Your Signing Secret",id:"steps-to-get-your-signing-secret",level:3},{value:"Verification Logic",id:"verification-logic",level:2},{value:"Headers",id:"headers",level:3},{value:"Payload Structure",id:"payload-structure",level:4},{value:"Steps to Verify the Webhook",id:"steps-to-verify-the-webhook",level:3},{value:"Example Code",id:"example-code",level:3}];function l(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Info: This documentent primarily focuses on library authors. If you want to integrate Lancer into your application please checkout ",(0,i.jsx)(n.a,{href:"/lancer-docs/fr/docs/quickstart",children:"SDK & Packages"})," page"]})}),"\n",(0,i.jsx)(n.p,{children:"The webhook verification endpoint is critical for ensuring that the events sent by the server are valid and originate from a trusted source. This involves verifying the payload, timestamp, and signature."}),"\n",(0,i.jsx)(n.h3,{id:"steps-to-get-your-signing-secret",children:"Steps to Get Your Signing Secret"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access the Admin Dashboard"}),":",(0,i.jsx)(n.br,{}),"\n","Log in to your Lancer admin dashboard with your admin credentials."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Navigate to Webhook Settings"}),":",(0,i.jsx)(n.br,{}),"\n","In the dashboard, go to the ",(0,i.jsx)(n.strong,{children:"Settings"})," section and select ",(0,i.jsx)(n.strong,{children:"Webhooks"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Generate a Signing Secret"}),":",(0,i.jsx)(n.br,{}),"\n","If a signing secret is not already generated, you can create one by clicking the ",(0,i.jsx)(n.strong,{children:"Generate Secret"})," button."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Copy the Secret"}),":",(0,i.jsx)(n.br,{}),"\n","Once generated, the signing secret will be displayed. ",(0,i.jsx)(n.strong,{children:"Copy it immediately"}),", as it will not be shown again for security reasons."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use the Secret in Your Code"}),":",(0,i.jsx)(n.br,{}),"\n","Add the signing secret to your backend server's configuration. This will be used to validate incoming webhook requests."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"verification-logic",children:"Verification Logic"}),"\n",(0,i.jsx)(n.p,{children:"The Lancer server sends the following headers and payload:"}),"\n",(0,i.jsx)(n.h3,{id:"headers",children:"Headers"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Header"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Content-Type"})}),(0,i.jsxs)(n.td,{children:["Specifies the type of content (e.g., ",(0,i.jsx)(n.code,{children:"application/json"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-signature"})}),(0,i.jsx)(n.td,{children:"HMAC-SHA256 signature of the payload, used to verify its authenticity."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-timestamp"})}),(0,i.jsx)(n.td,{children:"The UNIX timestamp when the payload was generated."})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"payload-structure",children:"Payload Structure"}),"\n",(0,i.jsx)(n.p,{children:"The payload contains the event type and its associated data. Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "event": "SESSION_CREATED",\n  "data": {\n    "id": "session_id_123",\n    "file_size": 10485760,\n    "chunk_size": 5242880,\n    "max_chunk": 2,\n    "file_name": "example_file.txt",\n    "temp_path": "/tmp/session_id_123",\n    "owner_id": "user_456",\n    "current_chunk": 0,\n    "provider": "LOCAL"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"steps-to-verify-the-webhook",children:"Steps to Verify the Webhook"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Recompute the HMAC Signature"}),"\n",(0,i.jsx)(n.p,{children:"Use the following formula to recompute the HMAC signature:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'signature = HMAC-SHA256(timestamp + "." + payload, signing_secret)\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Compare Signatures"}),"\n",(0,i.jsxs)(n.p,{children:["The computed signature must match the ",(0,i.jsx)(n.code,{children:"x-signature"})," header provided in the request."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Validate the Timestamp"}),"\n",(0,i.jsxs)(n.p,{children:["Ensure the ",(0,i.jsx)(n.code,{children:"x-timestamp"})," header is recent. You can reject requests where the timestamp is older than a certain threshold (e.g., 5 minutes) to prevent replay attacks."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-code",children:"Example Code"}),"\n",(0,i.jsx)(n.p,{children:"Here\u2019s an example implementation of the Webhook Verification Endpoint in Node.js:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'import express from "express";\nimport crypto from "crypto";\n\nconst app = express();\nconst SIGNING_SECRET = "your-signing-secret"; // Replace with your secret key\n\napp.use(express.json());\n\nfunction verifySignature(payload, timestamp, signature, secret) {\n  const message = `${timestamp}.${payload}`;\n  const hmac = crypto.createHmac("sha256", secret);\n  hmac.update(message);\n  const expectedSignature = hmac.digest("hex");\n  return crypto.timingSafeEqual(\n    Buffer.from(signature),\n    Buffer.from(expectedSignature)\n  );\n}\n\napp.post("/webhook", (req, res) => {\n  const sig = req.headers["x-signature"];\n  const timestamp = req.headers["x-timestamp"];\n  const payload = JSON.stringify(req.body);\n\n  if (!sig || !timestamp) {\n    return res.status(400).send("Missing required headers.");\n  }\n\n  const isValid = verifySignature(payload, timestamp, sig, SIGNING_SECRET);\n\n  if (isValid) {\n    console.log("Webhook verified successfully:", req.body);\n    return res.status(200).send("Webhook verified.");\n  } else {\n    console.log("Webhook verification failed.");\n    return res.status(403).send("Invalid signature.");\n  }\n});\n\napp.listen(3000, () => {\n  console.log("Webhook verification server running on port 3000.");\n});\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);